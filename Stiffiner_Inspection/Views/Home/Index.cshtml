<div class="wrap-content">
    <div id="inspection-statistical" class="d-flex justify-content-between">
        <div id="result">
            <h3 class="genera-title">Result</h3>
            <div class="d-flex justify-content-between">
                <div class="current-tray">
                    <h3 id="title-current-tray">Inspecting</h3>
                    <div class="d-flex check-item">
                        <div class="no-number">
                            <div class="empty-row">0</div>
                            <div class="no mb-1">No.</div>
                            @for (int i = 1; i <= 20; i++)
                            {
                                <div class="stt">@i</div>
                            }
                        </div>

                        <div class="is-check-tray checking-tray-left">
                            <div class="title-cam text-center">Left</div>
                            <div class="d-flex justify-content-between mb-1">
                                <div class="type-camera">Area cam 1</div>
                                <div class="type-camera">Line cam 2</div>
                            </div>
                            <div class="ng-ok">
                                <div class="d-flex justify-content-center">
                                    <div class="d-flex flex-column left-tray">
                                        @for (int i = 1; i <= 20; i++)
                                        {
                                            <span class="ok left-area-@i">Wait</span>
                                        }
                                    </div>
                                    <div class="d-flex flex-column right-tray">
                                        @for (int i = 1; i <= 20; i++)
                                        {
                                            <span class="ng left-line-@i">Wait</span>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="is-check-tray checking-tray-right">
                            <div class="title-cam text-center">Right</div>
                            <div class="d-flex justify-content-between mb-1">
                                <div class="type-camera">Area cam 3</div>
                                <div class="type-camera">Line cam 4</div>
                            </div>
                            <div class="ng-ok">
                                <div class="d-flex justify-content-center">
                                    <div class="d-flex flex-column left-tray">
                                        @for (int i = 1; i <= 20; i++)
                                        {
                                            <span class="ok right-area-@i">Wait</span>
                                        }
                                    </div>
                                    <div class="d-flex flex-column right-tray">
                                        @for (int i = 1; i <= 20; i++)
                                        {
                                            <span class="ng right-line-@i">Wait</span>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="previous-tray">
                    <h3 id="title-previous-tray">Previous</h3>

                    <div class="d-flex check-item">
                        <div class="no-number">
                            <div class="empty-row">0</div>
                            <div class="no mb-1">No.</div>
                            @for (int i = 1; i <= 20; i++)
                            {
                                <div class="stt">@i</div>
                            }
                        </div>

                        <div class="is-check-tray checking-tray-left">
                            <div class="title-cam text-center">Left</div>
                            <div class="d-flex justify-content-between mb-1">
                                <div class="type-camera">Area cam 1</div>
                                <div class="type-camera">Line cam 2</div>
                            </div>

                            <div class="ng-ok">
                                <div class="d-flex justify-content-center">
                                    <div class="d-flex flex-column left-tray" style="flex-basis: 49%">
                                        @for (int i = 1; i <= 20; i++)
                                        {
                                            <span class="wait">
                                                Wait
                                            </span>
                                        }
                                    </div>
                                    <div class="d-flex flex-column right-tray" style="flex-basis: 49%">
                                        @for (int i = 1; i <= 20; i++)
                                        {
                                            <span class="wait">
                                                Wait
                                            </span>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="is-check-tray checking-tray-right">
                            <div class="title-cam text-center">Right</div>
                            <div class="d-flex justify-content-between mb-1">
                                <div class="type-camera">Area cam 3</div>
                                <div class="type-camera">Line cam 4</div>
                            </div>
                            <div class="ng-ok">
                                <div class="d-flex justify-content-center">
                                    <div class="d-flex flex-column left-tray" style="flex-basis: 49%">
                                        @for (int i = 1; i <= 20; i++)
                                        {
                                            <span class="wait">Wait</span>
                                        }
                                    </div>
                                    <div class="d-flex flex-column right-tray" style="flex-basis: 49%">
                                        @for (int i = 1; i <= 20; i++)
                                        {
                                            <span class="wait">Wait</span>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="overview">
            <div class="wrap-overview">
                <h3 id="title-overview">Overview</h3>
                <div class="counting-status d-flex justify-content-between">
                    <div class="counting bg-white">
                        <div class="first-row d-flex align-items-center justify-content-between">
                            <div class="lbl-counting">Counting</div>
                            <div class="lbl-tray-total">
                                Target
                            </div>
                            <div class="lbl-number">@ViewBag.CurrTargetQty<span style="font-size: 14px;">EA</span></div>
                        </div>

                        <div class="second-row d-flex align-items-center justify-content-between mb-1">
                            <div class="title">Tray Total</div>
                            <div class="w-100 total">
                                @ViewBag.TotalTray
                            </div>
                        </div>

                        <div class="second-row d-flex align-items-center justify-content-between mb-1">
                            <div class="title">Total</div>
                            <div class="w-100 total">
                                @ViewBag.Total<span class="">EA</span>
                            </div>
                        </div>

                        <div class="third-row d-flex align-items-center justify-content-between mb-1">
                            <div class="title">OK</div>
                            <div class="w-100 total">
                                <div class="d-inline-block">
                                    @ViewBag.TotalOK<span>EA</span>
                                </div>
                                <span class="percent">@ViewBag.PercentOK %</span>
                            </div>
                        </div>

                        <div class="fourth-row d-flex align-items-center justify-content-between mb-1">
                            <div class="title">NG</div>
                            <div class="w-100 total">
                                <div class="d-inline-block">
                                    @ViewBag.TotalNG<span>EA</span>
                                </div>
                                <span class="percent">@ViewBag.PercentNG %</span>
                            </div>
                        </div>

                        <div class="second-row d-flex align-items-center justify-content-between mb-1">
                            <div class="title">Empty</div>
                            <div class="w-100 total">
                                @ViewBag.TotalEmpty<span class="">EA</span>
                            </div>
                        </div>
                    </div>

                    <div id="io-status" class="bg-white">
                        <div class="mt-1">
                            <div id="title-io-status" class="mb-2">IO Status</div>
                            @for (int i = 1; i <= 4; i++)
                            {
                                <div class="mb-2">
                                    <label class="label-title">PC@{@i}-Area Camera:</label>

                                    <span class="mx-4">
                                        <div class="dot-connect-@i div-status"></div>
                                        <label>Connect</label>
                                    </span>
                                    <span class="mx-5">
                                        <div class="dot-cam-@i div-status"></div>
                                        <label>CAM</label>
                                    </span>

                                    <span class="mx-4">
                                        <div class="dot-deep-core-@i div-status"></div>
                                        <label>Deep Learning</label>
                                    </span>
                                </div>
                            }

                            <div class="wr-system-status mb-2 mt-3">
                                <span id="label-system-status">System status:</span>
                                <span id="value-system-status">Pause</span>
                                <span id="error-system-status" class="d-none"></span>
                            </div>

                            <div class="plc-status mb-2">
                                <span id="label-plc-status">PLC connect status:</span>
                                <span id="value-plc-status">Disconnect</span>
                                <span id="error-plc-status" class="d-none">The door is opened</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="statistical-chart mt-4 d-flex justify-content-center">
                <div class="total-error">
                    @* <h3 id="title">Error Detect</h3>
                    <div class="total">
                        Total <span>0</span> detect
                    </div> *@
                </div>

                <div class="chart">
                    <canvas id="pie-chart" width="300" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div id="log-inspection" class="d-flex justify-content-between">
        <div id="result-log">
            <h3 class="genera-title">Result Log</h3>
            <table class="ea_table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Model</th>
                        <th>Tray Number</th>
                        <th>Side</th>
                        <th>No</th>
                        <th>Camera</th>
                        <th>Result</th>
                        <th>Error Detection</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="result-log-no-data">
                        <td colspan="12" class="w-100 text-lg-center text-dark fw-bold mt-1" style="font-size: 14px;">No data</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="time-log">
            <h3 class="genera-title">Time Log</h3>
            <table class="ea_table tbl-time-log">
                <thead>
                    <tr>
                        <th class="max-w90">Time</th>
                        <th class="max-w105">Type</th>
                        <th>Message</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="time-log-no-data">
                        <td colspan="12" class="w-100 text-lg-center text-dark fw-bold mt-1" style="font-size: 14px;">No data</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<script src="~/js/chart.js"></script>
<script src="~/js/chartjs-plugin-datalabels.min.js"></script>


<script>
    // Get the canvas element
    var ctx = document.getElementById('pie-chart').getContext('2d');

    var errorCodes = @Html.Raw(Json.Serialize(ViewBag.errorCodes));
    var labels = ["OK", "NG", "Empty"];
    var values = [65,20,15];

    const backgroundColor = [
        '#BE7B72', '#FDAF7B', '#824D74',
        // '#B692F6',
        // '#D6BBFB', '#E9D7FE', '#7F56D9', '#F4EBFF',
        // '#9E77ED', '#B692F6', '#D6BBFB', '#E9D7FE',
        // '#7F56D9', '#F4EBFF', '#9E77ED', '#B692F6',
        // '#D6BBFB'
    ]

     // errorCodes.forEach(function (item) {

     //     item.id > 10 ? values.push(item.id * 3) : "";

     //     labels.push(`${item.errorContent.toUpperCase()}`);
     // });

    var myPieChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
                data: values,
                backgroundColor: backgroundColor
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,

            title: {
                display: false,
                text: null,
            },
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#667085',
                    }
                },
                tooltip: {
                    enabled: false,
                },
                datalabels: {
                     formatter: (value, context) => {
                         const datapoints = context.chart.data.datasets[0].data;
                         function totalSum(total, datapoint) {
                             return total + datapoint;
                         }
                         const totalValue = datapoints.reduce(totalSum, 0);
                         const percentageValue = (value / totalValue * 100).toFixed(1);
                         return `${percentageValue}%`;
                     },
                    color: '#000000',
                    font: {
                        weight: 'bold',
                        size: 11,
                    },
                    align: 'end',
                    anchor: 'center'
                }
            }
        },
        plugins: [ChartDataLabels]
    });

     myPieChart.update('none');

</script>

@section Scripts {
    <script src="~/lib/microsoft-signalr/signalr.min.js"></script>
    <script src="~/js/home.js"></script>
}